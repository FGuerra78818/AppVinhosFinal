name: Build e Release Executável

on:
  push:
    tags:
      - 'v*'

jobs:
  build-and-release:
    runs-on: windows-latest

    steps:
      - name: Fazer checkout do código
        uses: actions/checkout@v3

      - name: Instalar .NET 8.0 SDK
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '8.0.x'

      - name: Restore de dependências
        run: dotnet restore

      - name: Publicar executável
        run: |
          dotnet publish \
            -c Release \
            -r win-x64 \
            --self-contained true \
            /p:PublishSingleFile=true \
            -o ./publish

      - name: Criar Release no GitHub
        id: create_release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ github.ref_name }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Anexar executável à Release
        uses: softprops/action-gh-release@v1
        with:
          files: ./publish/*.exe
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
